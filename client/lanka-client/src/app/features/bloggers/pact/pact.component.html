<div class="pact-container">
  <div class="flex justify-content-between align-items-center mb-4">
    <h2>My Pact</h2>
    <div class="flex gap-2">
      <button pButton 
              type="button" 
              label="Manage Offers" 
              icon="pi pi-shopping-bag" 
              class="p-button-outlined"
              (click)="navigateToOffers()">
      </button>
    </div>
  </div>

  <div *ngIf="loading && !pact && !isEditing" class="flex justify-content-center p-4">
    <p-progressSpinner></p-progressSpinner>
  </div>

  <div *ngIf="error && !isEditing" class="p-4">
    <p-message severity="error" [text]="error"></p-message>
  </div>

  <!-- Existing Pact View -->
  <div *ngIf="!loading && pact && !isEditing" class="pact-content">
    <p-card>
      <ng-template pTemplate="header">
        <div class="flex justify-content-between align-items-center p-3">
          <h3>Your Partnership Agreement</h3>
          <button pButton 
                  type="button" 
                  label="Edit Pact" 
                  icon="pi pi-pencil" 
                  class="p-button-outlined"
                  (click)="startEditing()">
          </button>
        </div>
      </ng-template>
      
      <ng-template pTemplate="content">
        <div class="pact-details">
          <div class="pact-text">
            <p class="pact-content-text">{{ pact.content }}</p>
          </div>
          
          <p-divider></p-divider>
          
          <div class="offers-section" *ngIf="pact.offers && pact.offers.length > 0">
            <h4>Associated Offers</h4>
            <div class="offers-grid">
              <div *ngFor="let offer of pact.offers" class="offer-item">
                <p-tag [value]="offer.name" severity="info"></p-tag>
                <span class="offer-price">{{ offer.priceAmount | currency:offer.priceCurrency }}</span>
              </div>
            </div>
          </div>
          
          <div *ngIf="!pact.offers || pact.offers.length === 0" class="no-offers">
            <p class="text-color-secondary">No offers associated with this pact yet.</p>
            <button pButton 
                    type="button" 
                    label="Create Your First Offer" 
                    icon="pi pi-plus" 
                    class="p-button-outlined mt-2"
                    (click)="navigateToOffers()">
            </button>
          </div>
        </div>
      </ng-template>
      
      <ng-template pTemplate="footer">
        <div class="flex justify-content-between">
          <span class="text-sm text-color-secondary">Pact ID: {{ pact.id }}</span>
          <button pButton 
                  type="button" 
                  label="Edit" 
                  icon="pi pi-pencil" 
                  (click)="startEditing()">
          </button>
        </div>
      </ng-template>
    </p-card>
  </div>

  <!-- Create/Edit Pact Form -->
  <div *ngIf="!loading && isEditing" class="pact-form-container">
    <p-card>
      <ng-template pTemplate="header">
        <div class="p-3">
          <h3>{{ pact ? 'Edit Your Pact' : 'Create Your Pact' }}</h3>
          <p class="text-color-secondary mt-2">
            {{ pact ? 'Update your partnership agreement with brands.' : 'Define your partnership terms and conditions for potential collaborations.' }}
          </p>
          <div *ngIf="!pact" class="mt-3 p-2 bg-blue-50 border-round">
            <div class="flex align-items-center gap-2">
              <i class="pi pi-info-circle text-blue-600"></i>
              <span class="text-sm text-blue-800">
                <strong>Helpful tip:</strong> We've provided a sample template below to get you started. 
                Feel free to customize it to match your collaboration style and requirements.
              </span>
            </div>
          </div>
        </div>
      </ng-template>
      
      <ng-template pTemplate="content">
        <form [formGroup]="pactForm" (ngSubmit)="onSubmit()">
          <div class="field">
            <div class="flex justify-content-between align-items-center mb-2">
              <label for="content" class="font-medium">
                Partnership Agreement Content
              </label>
              <button *ngIf="!pact" 
                      pButton 
                      type="button" 
                      label="Reset to Sample" 
                      icon="pi pi-refresh" 
                      class="p-button-text p-button-sm"
                      (click)="resetToSample()">
              </button>
            </div>
            <textarea pTextarea 
                      id="content"
                      formControlName="content" 
                      placeholder="Describe your partnership terms, collaboration expectations, content guidelines, and any other relevant information for potential brand partners..."
                      rows="10"
                      class="w-full">
            </textarea>
            <small class="help-text text-color-secondary">
              Minimum 50 characters, maximum 2000 characters. 
              Current: {{ pactForm.get('content')?.value?.length || 0 }} characters
            </small>
            <small class="p-error block mt-1" *ngIf="getFieldError('content')">
              {{ getFieldError('content') }}
            </small>
          </div>

          <div class="form-actions flex gap-2 mt-4">
            <button pButton 
                    type="button" 
                    label="Cancel" 
                    class="p-button-outlined flex-1"
                    (click)="cancelEditing()"
                    [disabled]="loading"
                    *ngIf="pact">
            </button>
            <button pButton 
                    type="submit" 
                    [label]="pact ? 'Update Pact' : 'Create Pact'" 
                    [class]="pact ? 'flex-1' : 'w-full'"
                    [disabled]="pactForm.invalid || loading"
                    [loading]="loading">
            </button>
          </div>
        </form>
      </ng-template>
    </p-card>
  </div>

  <!-- No Pact State -->
  <div *ngIf="!loading && !pact && !isEditing && !error" class="no-pact-message">
    <div class="text-center p-6">
      <i class="pi pi-file-edit" style="font-size: 3rem; color: var(--text-color-secondary);"></i>
      <h3>Create Your Partnership Agreement</h3>
      <p class="text-color-secondary">
        A pact helps brands understand your collaboration terms and expectations. Define your partnership terms, collaboration guidelines, and requirements for potential brand collaborations.
      </p>
      <button pButton 
              type="button" 
              label="Create Your Pact" 
              icon="pi pi-plus" 
              class="mt-3"
              (click)="startEditing()">
      </button>
    </div>
  </div>

  <!-- Error State with Action -->
  <div *ngIf="!loading && error && !pact && !isEditing" class="error-state-container">
    <p-card>
      <ng-template pTemplate="content">
        <div class="text-center p-4">
          <i class="pi pi-exclamation-triangle" style="font-size: 2rem; color: var(--red-500); margin-bottom: 1rem;"></i>
          <h3>Unable to Load Pact</h3>
          <p class="text-color-secondary mb-4">{{ error }}</p>
          <div class="flex gap-2 justify-content-center">
            <button pButton 
                    type="button" 
                    label="Try Again" 
                    icon="pi pi-refresh" 
                    class="p-button-outlined"
                    (click)="loadPact()">
            </button>
            <button pButton 
                    type="button" 
                    label="Create New Pact" 
                    icon="pi pi-plus" 
                    (click)="startEditing()">
            </button>
          </div>
        </div>
      </ng-template>
    </p-card>
  </div>
</div>
