# Jaeger for Trace Visualization

Jaeger is an open-source, distributed tracing system used for monitoring and troubleshooting complex microservices-based applications. It allows you to visualize the flow of requests through the system and identify performance bottlenecks.

## Usage in Lanka Project

In the Lanka project, Jaeger is used to visualize traces generated by OpenTelemetry.

## Configuration

### Docker Compose

Jaeger is configured in the `docker-compose.yml` file.

*   **Example (`docker-compose.yml`):**

    ```yaml
    services:
      lanka.jaeger:
        image: jaegertracing/all-in-one:latest
        container_name: Lanka.Jaeger
        ports:
          - "4317:4317"
          - "4318:4318"
          - "16686:16686"
    ```

### OTLP Endpoint

OpenTelemetry is configured to send traces to Jaeger using the OTLP exporter. The OTLP endpoint is configured using the `OTEL_EXPORTER_OTLP_ENDPOINT` environment variable.

* **Example (`src/Api/Lanka.Api/appsettings.json`):**

    ```json
    {
      "OTEL_EXPORTER_OTLP_ENDPOINT": "http://localhost:4317"
    }
    ```

## Accessing the Jaeger UI

1. Run the Jaeger Docker container using `docker-compose up`.
2. Access the Jaeger UI at `http://localhost:16686`.
3. Select the service you want to view traces for (e.g., `Lanka.Api`, `Lanka.Gateway`).
4. Click "Find Traces" to view the traces for the selected service.

## Screenshots

![Jaeger UI - Trace List](/docs/images/jaeger-request-traces.jpg)

### Using LogContext

You can use `LogContext` to add contextual information to logs. In the Lanka project, the `TraceId` is added to the log context in the `LogContextTraceLoggingMiddleware`.

```csharp
using Serilog.Context;

public Task Invoke(HttpContext context)
{
    string traceId = Activity.Current?.TraceId.ToString();

    using (LogContext.PushProperty("TraceId", traceId))
    {
        return next.Invoke(context);
    }
}
```

![Seq-TraceId](/docs/images/seq-trace-id.jpg)
